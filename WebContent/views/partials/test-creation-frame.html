<div id="TestCreationArea" class="test-creation-frame">
    <div class="row">
        <div id="caption" class="width30 pull-left margin-lft-5">
            <h4>Create or Edit Tests</h4>
        </div>
        <div class="width67 pull-right text-right">
        <button type="button" class="btn btn-primary"
                    ng-disabled="sharedTabService.isTestWizardTabPresent"
                    ng-click="addTestWizard()" tooltip="Test Creation Wizard" tooltip-placement="bottom">
                <span class="icon-magic"></span> Test wizard
            </button>

            <div class="btn-group" role="group" aria-label="...">
                <div class="btn-group save-dropdown margin-rt-5" role="group">
                    <button class="btn btn-primary dropdown-toggle" type="button" ng-disabled="tests[currentIndex].isTestWizard && tests[currentIndex].testId == null"
                            id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                        Save
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu margin-rt-5" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation"><a ng-click="saveTest()" ng-disabled="tests[currentIndex].isTestWizard && tests[currentIndex].testId == null" tooltip="Save your tests" tooltip-placement="left" role="menuitem" tabindex="-1">Save</a></li>
                        <li role="presentation"><a ng-click="openSaveAsTestDialog()" ng-disabled="tests[currentIndex].isTestWizard && tests[currentIndex].testId == null" tooltip="Save your tests as" tooltip-placement="left" role="menuitem" tabindex="-1">Save As</a></li>
                    </ul>
                </div>                
                <button type="button" class="btn btn-primary  margin-rt-5" tooltip="Print and Format Tests" tooltip-placement="bottom">Print</button>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary {{exportBtnCss}}"
                        ng-click="open()" tooltip="Export Test Files" tooltip-placement="bottom">
                    Export
                </button>
            </div>
        </div>
    </div>

    <!-- <div id="NewVersion" ng-show="ShowNewVersion"
        class="form-inline  panel panel-default container-full newVersion-container">
        <div>
            <h4>Create New Version(s) of Test</h4>
        </div>
        <div class="form-group container-full">
            <div>
                <label><h5>Scramble:</h5></label>

                <div class="checkbox vsQuestion">
                    <label> <input type="checkbox" ng-model="isQuestions">
                        Questions
                    </label>
                </div>
                <div class="checkbox vsAnswers">
                    <label> <input type="checkbox" ng-model="isAnswers">
                        Answers
                    </label>
                </div>
            </div>
            <div class="vnSelectDiv-container">
                <label for="selectNumber"><h5>Number:</h5></label> <select
                    id="selectNumber" data-role="listview" class="form-control"
                    data-inset="true" ng-model="selectedVersions"
                    ng-options="version as version.text for version in versions "
                    x-ng-change="selectVersion(selectedVersions)"></select>

                <div class="checkbox vsQuestion">
                    <label> <input type="checkbox" ng-model="isViewVersions">
                        View Versions
                    </label>
                </div>
                <button ng-click="createNewVersion()"
                    class="btn btn-primary pull-right">Create Version</button>
            </div>
        </div>
    </div> -->
</div>

<div id="content">
    <div class="wrap full full-width-tabs">

        <ul class="nav nav-tabs test-tabs" id="mytab">
        <li ng-click="addNewTest()">
                <button type="button"
                        class="btn btn-default glyphicon glyphicon-plus addNewTab" tooltip="New tab" tooltip-placement="bottom"></button>
            </li>
            
            <li ng-show="$index < 5" ng-repeat="test in tests"
                ng-class="{active: isActiveTab(test.id)}"
                ng-click="onClickTab(test)" id="{{test.id}}">
                <div class="newTest-close glyphicon glyphicon-remove"
                      
                     ng-click="closeTabWithConfirmation(test)"></div> <a href="" title="{{test.tabTitle}}"
                                                                         data-toggle="tab">{{test.tabTitle}}</a>
            </li>
            <li class="dropdown" ng-show="tests.length > 5">
  				<a class="dropdown-toggle dot" data-toggle="dropdown">...</a>
  					<ul class="dropdown-menu">
    					<li ng-show="$index >= 5" ng-repeat="test in tests" ng-class="{active: isActiveTab(test.id)}"
                		ng-click="onClickTab(test)" id="{{test.id}}">
                		<div class="newTest-close glyphicon glyphicon-remove"
                     	ng-click="closeTabWithConfirmation(test)"></div> <a href="" title="{{test.tabTitle}}">{{test.tabTitle}}</a>
    					</li>
  					</ul>
				</li>
            </ul>
            
    </div>
</div>
<div class="QuestionArea">
    <!-- Bootstrap css main container -->
    <div class="row">
        <div class="questionFeature">
            <button ng-click="TestVersion_open()"
                    class="btn btn-primary pull-right {{newVersionBtnCss}}">
                New
                Version
            </button>
        </div>
    </div>
    <div class="row" ng-show=" tests[currentIndex].isTestWizard">
        <div class="col-lg-10">
            <br /> <b>
                <p class='tw-helptext-head'>
                    <span class="glyphicon icon-magic" aria-hidden="true"></span>
                    Welcome to Evalu8 Test Wizard
                </p>
                <p>
                    Evaluate will create a test from the topics and criteria you
                    pick
                </p>
                <p ng-show="tests[currentIndex].criterias.length == 0">
                    1. Select
                    topic(s) or chapter(s) in the questions bank on the left and drag
                    here or click the Wizard wand icon on the topic.
                </p>
                <div ng-show="tests[currentIndex].criterias.length != 0">
                    <ol>
                        <li>Enter test title</li>
                        <li>Select criteria for each selected bank</li>
                        <li>Select Create Test button</li>
                    </ol>
                </div>
            </b>
        </div>
    </div>
    <div class="row"
         ng-hide="tests[currentIndex].isTestWizard && tests[currentIndex].criterias.length == 0">
        <div class="col-lg-1 text-right">
            <h4>Test</h4>
        </div>
        <div class="col-lg-11">
            <input type="text" ng-model="tests[currentIndex].title"
                   ng-change="updateTestTitle(testTitle)" id="testCaption"
                   class="form-control input-sm" placeholder="Enter test title">
        </div>
    </div>
    <div class="row" ng-show="!tests[currentIndex].isTestWizard">
        <div class="col-lg-1 text-right">
            <h4>Name</h4>
        </div>
    </div>
    <div class="row"
         ng-show="tests[currentIndex].isTestWizard &&  tests[currentIndex].criterias.length != 0" ">
		<!--{{tests[currentIndex].criterias}}-->
		<!--<button type=" button" class="btn btn-default" ng-click="addTestWizardCriteria()">
        <span class="icon-magic"></span>Add Test wizard</button>-->
        <div class="test-wizard-container">
            <div class="row"
                 ng-repeat="criteria in tests[currentIndex].criterias" ng-show="$first || !isApplySameCriteriaToAll">
                <div class="col-lg-11  form-inline  panel panel-default bg-gray-lighter">
                    <button type="button" class="close"
                            ng-click="closeCriteria(criteria,true)" aria-label="Close" tooltip="Delete this section" tooltip-placement="bottom">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <!-- <div>
                        <b>Selected Questions : {{criteria.folderTitle}}
                            ({{criteria.totalQuestions}} Questions)</b>
                    </div> -->
                    <div class="row">
                        <div class="col-lg-5">
                            <b>Selected Questions :</b>
                        </div>
                        <div class="col-lg-6" ng-show="$first && !$last">
                            <input id="applyCriteria" type="checkbox" ng-model="isApplySameCriteriaToAll"
                                   ng-change='toggleApplySameCriteria(this)'>Use same
                            criteria for all topics
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <ul>
                                <li ng-repeat="topic in tests[currentIndex].criterias" ng-if="topic.folderTitle == criteria.folderTitle || isApplySameCriteriaToAll">
                                    <span>{{topic.folderTitle}} ({{topic.totalQuestions}} Questions)</span>
                                    <button type="button" class="close btnChapterClose" ng-show="isApplySameCriteriaToAll"
                                            ng-click="closeCriteria(topic,false)" aria-label="Close" tooltip="Delete this section" tooltip-placement="bottom">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="row form-group container-full">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-lg-2">
                                    <h5>Questions:</h5>
                                </div>
                                <div class="col-lg-10">
                                    <div class="row criteriaAlign">
                                        <div class="col-lg-2 text-right no-padding"
                                             ng-repeat="defaultNumberOfQuestion in criteria.defaultNumberOfQuestions">
                                            <input type="radio" name="{{criteria.id}}"
                                                   ng-model="criteria.numberOfQuestionsSelected "
                                                   value="{{defaultNumberOfQuestion}}"
                                                   ng-change="fillQuestionCount(criteria)"
                                                   ng-disabled='criteria.totalQuestions < defaultNumberOfQuestion'>{{defaultNumberOfQuestion}}
                                        </div>
                                        <div class="col-lg-2">
                                            <input type="text"
                                                   ng-disabled='criteria.numberOfQuestionsSelected > 0'
                                                   ng-model="criteria.numberOfQuestionsEntered"
                                                   ng-change="SelecteNumberOnly(criteria)"
                                                   placeholder="Enter #"
                                                   class="form-control input-sm tw-no-of-qns-input" />
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="row">
                                <div class="col-lg-2 text-center">
                                    <h5>Type:</h5>
                                </div>
                                <div class="col-lg-10">
                                    <div class="row">
                                        <div class="col-lg-4"
                                             ng-repeat="questiontype in sharedTabService.QuestionTypes">
                                            <div class="ck-button">
                                                <label ng-class="(criteria.questiontypes.indexOf(questiontype.key) == -1) ? 'disabled-cursor' : '' ">
                                                    <input type="checkbox"
                                                           ng-disabled='criteria.questiontypes.indexOf(questiontype.key) == -1'
                                                           ng-model="value" value="{{questiontype.key}}"
                                                           ng-click='toggleQuestiontypeSelection(criteria,questiontype.key)'
                                                           ng-checked="criteria.selectedQuestiontypes.indexOf(questiontype.key) != -1"><span>{{questiontype.value}}</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-7 text-right">
                    Add another topic or select
                    Create Test
                </div>
                <div class="col-lg-3 pull-right">
                    <button class="btn btn-primary" ng-click="previevTest()">
                        Create
                        test
                    </button>
                </div>
                <div class="col-lg-2 pull-right">
                    <button class="btn btn-default"
                            ng-click="closeTab(tests[currentIndex])">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/ng-template" id="questions_renderer.html">
        <div ui-tree-handle class="printViewContainer tree-node tree-node-content questionList" ng-class="{questionTitleInTree: node.questionXML}">
            <div ng-if="node.textHTML" ng-bind-html="getHTML(this)">
            </div>
        </div>
    </script>
    <!--  <div class="questionCreationArea">
            <div class="newtestCaptionDiv">
                <label for="testCaption"> Test </label>    <input type="text" placeholder="Enter test title" ng-model="tests[currentIndex].title" ng-change="updateTestTitle(testTitle)" id="testCaption" />
            </div>
        </div>
        <div>
            <span class="testCreationName">Name:</span>
        </div>
    -->
    <div id="qstnArea" ng-show="!tests[currentIndex].isTestWizard">
    <div data-ui-tree id="tree2-root">
    	<!-- <div class="row"> -->
        <div class="TestcreationInfo" ng-show="!tests[currentIndex].questions.length && !tests[currentIndex].isTestWizard">
                
                    <span class="fa fa-lightbulb-o circle-icon pull-left" aria-hidden="true"></span>
                   <p> To create a new test, drag questions here from the Question Banks
                    or Custom Questions.
                </p>
                <p>
                    To edit one of your tests, open Your Tests and drag test
                    here.
                </p>
                <p>
                    To create a test automatically from selected topics, select
                    the Test Wizard button.
                </p>
        </div>
   <!--  </div> -->
        
            <div ng-show="isLoading">
                <span class="glyphicon glyphicon-refresh spinning"></span>
                Loading...
            </div>
            <ol droppable="true" ui-tree-nodes id="QuestArea" class="questIndex"
                type="1" ng-model="tests[currentIndex].questions">
                <li draggable="{{!node.IsEditView}}" quiztype={{node.quizType}} class="questIndex displayQuestionLI" printmode="{{!node.IsEditView}}"
                    templateqstn="{{node.templateQstn}}" ng-mouseover="hoverIn(this)" ng-mouseleave="hoverOut()"
                    optionsview={{node.optionsView}}
                    ng-repeat="node in tests[currentIndex].questions" ui-tree-node
                    ng-include="'rf_question_renderer.html'"></li>
            </ol>
        </div>

        <script type="text/ng-template" id="rf_question_renderer.html">
           <div class="qstnContainer">
<div class="qstnView">
	<div class="glyphicon glyphicon-remove closeQuestion " ng-show="closeQstnBtn"
     	ng-click="closeQuestions(tests[currentIndex],$index)">
  	</div>
   <div class="questionEditCaption editView">
      {{node.editMainText}}
   </div>
   <a class="qstnViewLink" ng-click="showQstnPrintOrEditMode(this)"
      ng-show="showQstnEditIcon" tooltip="{{node.qstnLinkTitle}}" tooltip-placement="bottom">{{node.qstnLinkText}}</a>
</div>
<div ui-tree-handle class="tree-node tree-node-content questionList">
   <div ng-class="node.IsEditView ? 'editViewContainer' : 'printViewContainer' "
      bind-qti="getHTML(this)"></div>
</div>
<div class="editMetdata editView">
   <div class="imagecaptionMetadata">
      <input ng-src="{{isMetadataExpand && 'images/right_arrow.png' || 'images/right_arrow2.png' }}" ng-click="isMetadataExpand = !isMetadataExpand" class="downArrowImage allignimage" type="image" /> 
       <!--  src="images/right_arrow.png" /> -->
	 </div>
	<div  class="mainClass" >
      <div  class="captionMetadata	">
         Format and add
         metadata
      </div>
  <div ng-show="isMetadataExpand"> 
   <div class="vhDiv" ng-show=" node.quizType == 'MultipleChoice' || node.quizType == 'MultipleResponse' ">
	   <div id="viewHeader">
      			<span class="captionMetadata">Format</span><span class="normalText">
     			 (visible in Print View)
     		 </span>
     </div>
      <span class="viewOptionDiv normalText">Questions:</span>
      <div class="viewOptionDiv viewOptionHV">
         <input class="radioView" ng-checked="node.optionsView" name="radioView_{{$index}}_HV" ng-click="qstnOptionsView(this,true)" type="radio">Vertical Display </input>
      </div>
      <div class="viewOptionDiv viewOptionHV">
         <input name="radioView_{{$index}}_HV" ng-checked="!node.optionsView" ng-click="qstnOptionsView(this,false)" type="radio">Horizontal Display </input>
      </div>
   </div>
   <div class="EssaySpaceDiv" ng-show="node.quizType == 'Essay'">    
   <span class="viewOptionDiv normalText">Essay Space:</span>
      <div class="viewOptionDiv viewOptionHV">
         <input class="radioView" ng-checked="node.EssayPageSize == '0'" pageSize='0'  name="radioView_{{$index}}_PV" ng-click="qstnEssayPageSize(this,'0')"  type="radio">None</input>
      </div>
      <div class="viewOptionDiv viewOptionHV">
         <input name="radioView_{{$index}}_PV"  ng-checked="node.EssayPageSize == '10'" ng-click="qstnEssayPageSize(this,'10')" pageSize='10'  type="radio">1/4 page</input>
      </div>
      <div class="viewOptionDiv viewOptionHV" >
         <input name="radioView_{{$index}}_PV"  ng-checked="node.EssayPageSize == '20'" ng-click="qstnEssayPageSize(this,'20')" pageSize='20'  type="radio">1/2 page</input>
      </div>
      <div class="viewOptionDiv viewOptionHV">
         <input name="radioView_{{$index}}_PV"  ng-checked="node.EssayPageSize == '40'" ng-click="qstnEssayPageSize(this,'40')" pageSize='40'  type="radio">1 page</input>
      </div>
   </div>
<div class="BlankSizeDiv" ng-show="node.quizType == 'FillInBlanks'" >
		<span class="viewOptionDiv normalText">Blank Size:</span>
		<div class="viewOptionDiv viewOptionHV">
			<input class="radioView" name="radioView_{{$index}}_BS" ng-checked="node.BlankSize == '20'"  ng-click="qstnBlankSize(this,'20')"  blankSize='20' type="radio">Small</input>
		</div>
		<div class="viewOptionDiv viewOptionHV">
			<input name="radioView_{{$index}}_BS" ng-checked="node.BlankSize == '50'"  ng-click="qstnBlankSize(this,'50')"  blankSize='50'  type="radio">Medium</input>
		</div>	
		<div class="viewOptionDiv viewOptionHV">
			<input name="radioView_{{$index}}_BS" ng-checked="node.BlankSize == '100'"  ng-click="qstnBlankSize(this,'100')"  blankSize='100'  type="radio">Large</input>
		</div>			
	</div>

<div ng-show={{node.IsUserMetdataAvailable}} class="metadataSection">
<div class='metadataSectionCaption'>Metadata</div>

    <div ng-show={{node.questionMetadata['Difficulty']==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Difficulty:</span>
        <div class="metdataVal">
			<select class='metadataQlvl' ng-model="node.selectedLevel"  ng-options="level.name for level in Difficulty  track by level.value">
       		</select>           
        </div>
    </div>	
	<div ng-show={{node.questionMetadata['Topic']==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Topic:</span>
        <div class="metdataVal">
            <input class='metdataInput' data-ng-model="node.questionMetadata.Topic" type="textbox"></input>
        </div>
    </div>
    <div ng-show={{node.questionMetadata['Objective']==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Objective:</span>
        <div class="metdataVal">
            <input class='metdataInput' data-ng-model="node.questionMetadata.Objective" type="textbox"></input>
        </div>
    </div>
	<div ng-show={{node.questionMetadata["PageReference"]==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Page Reference:</span>
        <div class="metdataVal">
            <input class='metdataInput' data-ng-model="node.questionMetadata['PageReference']" type="textbox" /></input>
        </div>
    </div>
	 <div ng-show={{node.questionMetadata['Skill']==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Skill:</span>
        <div class="metdataVal">
            <input class='metdataInput' data-ng-model="node.questionMetadata.Skill" type="textbox" /></input>
        </div>
    </div>
   	<div ng-show={{node.questionMetadata['QuestionId']==undefined?false:true}} class='metadatarow'><span class='metdatalabel'>Question ID:</span>
        <div class='metdataVal'>{{node.guid}}</div>
    </div>   
</div>
</div>
</div>
   
</div>

</div>

        </script>
        <div id="uploadImage" class="uploadImage" ng-show="imageClicked" ng-file-drop ng-accept="'image/*'" data-ng-file-change="upload($files)" drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}">
            <div>Drag picture here or browse to upload.</div>
            <input class="uploadBtn" type="button" value="Browse" data-ng-file-select data-ng-file-change="upload($files)" ng-accept="'*.jpg,*.png,*.tif,*.tiff,*.gif,*.jpeg,*.bmp'" />
        </div>
    </div>
</div>